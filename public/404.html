<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Ilzebrenn</title>
    <script>
      // Enhanced Single Page Apps for GitHub Pages
      // Modified version of https://github.com/rafgraph/spa-github-pages

      // If you're creating a Project Pages site and NOT using a custom domain,
      // then set pathSegmentsToKeep to 1 (enterprise users may need to set it to > 1).
      // Otherwise, with a custom domain, leave pathSegmentsToKeep as 0.
      var pathSegmentsToKeep = 0

      var l = window.location

      // Check if we're already in a redirect loop
      if (l.search && l.search.includes('redirect=true')) {
        // Emergency escape from redirect loop - go to root
        l.replace(l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') + '/')
      } else {
        // Clean pathname of any percent characters or encoding issues
        var cleanPathname = l.pathname

        // Try to decode any percent encoding
        try {
          cleanPathname = decodeURIComponent(cleanPathname)
        } catch (e) {
          // If decoding fails, just use the raw path
          console.error('Failed to decode path', e)
        }

        // Remove any remaining percent characters that couldn't be decoded
        cleanPathname = cleanPathname.replace(/%/g, '')

        // Store the current path in sessionStorage for the main page to read
        sessionStorage.setItem('redirectPath', cleanPathname)

        // Redirect to the index page with a special parameter that indicates we want to restore the path
        l.replace(
          l.protocol +
            '//' +
            l.hostname +
            (l.port ? ':' + l.port : '') +
            '/' +
            (l.search ? l.search + '&redirect=true' : '?redirect=true'),
        )
      }
    </script>
  </head>
  <body></body>
</html>
